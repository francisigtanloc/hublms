{% set topics = get_topics(course.name) %}
{% set is_instructor = is_instructor(course.name) %}

{% if topics | length %}
<div class="course-home-outline">

    {% if not lesson_page %}
    <div class="page-title mb-8" id="outline-heading" data-course="{{ course.name }}">
        {{ _("Course Content") }}
    </div>

    <!-- <div class="mb-2">
        <span>
            {{ chapters | length }} chapters
        </span>
        <span>
            . {{ get_lessons(course.name, None, False) }} lessons
        </span>
    </div> -->
    {% endif %}

    {% if topics | length %}
    <div>
    {% for topic in topics %}
    {% set topic_content = get_topic_contents(course.name, topic) %}

    <div class="chapter-parent" data-chapter="{{ topic.name }}">

        <div class="chapter-title" data-toggle="collapse" aria-expanded="false"
        data-target="#{{ get_slugified_chapter_title(topic.name) }}">

            <img class="chapter-icon" src="/assets/lms/icons/chevron-right.svg">
            <div class="chapter-title-main">
                {{ topic.name }}
            </div>
            <!-- <div class="small ml-auto">
                {{ lessons | length }} lessons
            </div> -->
        </div>


        <div class="chapter-content collapse navbar-collapse" id="{{ get_slugified_chapter_title(topic.name) }}">

            {% if topic.description %}
            <div class="chapter-description">
                {{ topic.description }}
            </div>
            {% endif %}

            <div class="lessons">

                {% if topic_content | length %}

                {% for content in topic_content %}
                {% set url_index =  "{}{}{}".format(topic.idx,'.', content.idx) %}
                {% set active =  "{}{}{}".format(topic_index,'.', content_index) == "{}{}{}".format(topic.idx,'.', content.idx) %}
                
                <div data-lesson="{{ content.content }}" class="lesson-info {% if active %} active-lesson {% endif %}">

                    <a class="lesson-links"
                    href="{{ get_lesson_url(course.name, url_index) }}"
                    {% if is_instructor and not lesson.include_in_preview %}
                    title="{{ _('This lesson is not available for preview. As you are the Instructor of the course only you can see it.') }}"
                    {% endif %}>

                        <svg class="icon icon-sm mr-2">
                            <use class="" href="#{{ content.icon }}">
                        </svg>
                        <div>{{ content.content }}</div>

                    </a>
                </div>

                {% endfor %}

            {% endif %}
            </div>

        </div>
    </div>
    {% endfor %}
    </div>

    {% endif %}

</div>
{% endif %}

{% if chapters | length %}
<!-- No Preview Modal -->
{{ widgets.NoPreviewModal(course=course, membership=membership) }}

{% endif %}
